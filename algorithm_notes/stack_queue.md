# 栈队列专题

## 专题概述

栈和队列是两种基础且重要的数据结构，在算法问题中应用广泛。本专题涵盖：
- **单调栈**: 维护单调性，解决矩形面积、雨水收集等问题
- **单调队列**: 滑动窗口最值、区间查询优化
- **栈的应用**: 最小栈、有效括号、表达式求值
- **队列的应用**: BFS、层序遍历、优先队列

**核心思想**: 利用栈的LIFO和队列的FIFO特性，配合单调性维护，高效解决特定模式的问题。

## 核心题目

### 239. 滑动窗口最大值 (Hard) - 单调队列
**核心思想**: 单调双端队列维护窗口最大值，存储下标，保持递减序列
**关键操作**: 移除过期元素 → 维护单调性 → 添加当前元素
**复杂度**: O(n) - 每个元素最多入队出队一次
**易错点**: 存储下标不是值，过期判断`<=`，窗口满判断`i >= k - 1`

### 155. 最小栈 (Medium) - 双栈设计
**核心思想**: 主栈+辅助栈，辅助栈维护最小值
**关键技巧**: push时用`<=`处理重复最小值
**复杂度**: O(1)所有操作

### 84. 柱状图中最大矩形 (Hard) - 单调栈
**核心思想**: 单调递增栈，弹栈时计算面积
**关键公式**: `面积 = 高度 × (右边界 - 左边界 - 1)`
**技巧**: 数组两端加0简化边界处理

### 42. 接雨水 (Hard) - 单调栈变种
**核心思想**: 单调递减栈，按层计算雨水
**关键要素**: 左边界(栈中剩余) + 底部(弹出元素) + 右边界(当前元素)

## 单调栈核心模板

```cpp
// 单调递增栈 - 用于寻找每个元素左/右侧第一个更小元素
vector<int> monotoneStack(vector<int>& nums) {
    stack<int> st;  // 存储下标
    vector<int> result(nums.size());
    
    for (int i = 0; i < nums.size(); i++) {
        // 维护单调性：当前元素较小时弹出
        while (!st.empty() && nums[i] < nums[st.top()]) {
            int idx = st.top();
            st.pop();
            // 此时找到了nums[idx]右侧第一个更小元素nums[i]
            result[idx] = i;
        }
        st.push(i);
    }
    return result;
}
```

## 单调队列核心模板

```cpp
// 滑动窗口最大值模板
vector<int> maxSlidingWindow(vector<int>& nums, int k) {
    deque<int> dq;  // 存储下标，保持递减
    vector<int> result;
    
    for (int i = 0; i < nums.size(); i++) {
        // 移除过期元素
        while (!dq.empty() && dq.front() <= i - k) {
            dq.pop_front();
        }
        
        // 维护单调性
        while (!dq.empty() && nums[i] >= nums[dq.back()]) {
            dq.pop_back();
        }
        
        // 添加当前元素
        dq.push_back(i);
        
        // 窗口形成后记录结果
        if (i >= k - 1) {
            result.push_back(nums[dq.front()]);
        }
    }
    return result;
}
```

## 易错点总结

1. **存储下标vs值**: 单调栈/队列通常存储下标，便于计算距离和检查过期
2. **单调性方向**: 递增栈用于找更小元素，递减栈用于找更大元素
3. **边界处理**: 数组两端添加哨兵值可简化边界逻辑
4. **窗口判断**: 滑动窗口要用`i >= k-1`判断是否形成完整窗口
5. **重复元素**: 最小栈用`<=`处理重复最小值的正确出栈

## 相关题目

- **单调栈**: 84柱状图最大矩形、42接雨水、496下一个更大元素、739每日温度
- **单调队列**: 239滑动窗口最大值、862和至少为K的最短子数组
- **栈应用**: 155最小栈、20有效括号、150逆波兰表达式
- **队列应用**: 102层序遍历、347前K个高频元素

---
*单调栈和单调队列是高效解决"寻找最值"类问题的利器，掌握其单调性维护是关键*